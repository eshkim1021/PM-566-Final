---
title: "PM 566 Midterm Assignment"
author: "Edy Kim"
date: "10/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(tidyverse)
library(httr)
library(dplyr)
```


## Introduction
  
  The COVID-19 pandemic still heavily impacts the United States, with the US surpassing over 200,000 deaths since cases have first been recorded. To shed further insight into the severity of the panemic, the __"Provisional COVID-19 Death Count by Sex, Age, and State"__ (https://data.cdc.gov/resource/9bhg-hcku.json) data was taken from the __Center for Disease Control__ and analyzed. The data includes the number of COCIVD-19 deaths between February 2020 and August 2020 that was reported to the __National Center for Health Statistics__ by sex, age group, and state. In addition, the number of deaths due to pneumonia, often caused by severe COVID symptoms, was also included in the data set. The data set was accessed on 10/6/2020, and reflects the current statistics at the time. 
  
  
The main purpose of this project is to analyze:

1)The effect of __age__, __gender__, and __geographical location__ on the COVID-19 mortality rate.

2)The frequency of __pneumonia__ in COVID-19 patients, and its affect on patiant mortality. 
  
## Methods 

The dataset, __"Provisional COVID-19 Death Count by Sex, Age, and State"__ (https://data.cdc.gov/resource/9bhg-hcku.json), was accessed from the __Center for Disease Control__ website through an API. 

```{r Obtain API, include = FALSE}
data <- GET(
  url = "https://data.cdc.gov",
  path = "/resource/9bhg-hcku.json"
  
)
data <- content(data)
dat <- as.character(data)
```


```{r Web Scrapping,include = FALSE}
#

#Extract Gender
gender <- str_extract_all(dat, "sex = \"[:alpha:]+ [:alpha:]+|sex = \"[:alpha:]+")
gender <- str_remove_all(gender, "sex = \"")

#Extract state of death 
state <- str_extract_all(dat, "state = \"[:alpha:]+|state = \"[:alpha:]+ [:alpha:]+")
state <- str_remove_all(state, "state = \"")

#Extract age group 
age_group <- str_extract_all(dat, "age_group_new = \"[0-9]+-[0-9]+ [:alpha:]+|age_group_new = \"[:alpha:]+ [:alpha:]+|age_group_new = \"[:alpha:]+ [0-9]+ [:alpha:]+|age_group_new = \"[0-9]+ [:alpha:]+ [:alpha:]+ [:alpha:]+")
age_group <-str_remove_all(age_group, "age_group_new = \"")

#Covid-19 Deaths 
covid <- str_extract_all(dat," covid_19_deaths = \"[:alnum:]+")
covid <- str_remove_all(covid, " covid_19_deaths = \"")

#Pneumonia_deaths
pneumonia <- str_extract_all(dat, "pneumonia_deaths = \"[:alnum:]+")
pneumonia <- str_remove_all(pneumonia, "pneumonia_deaths = \"")

#Pneumonia and COVID Deaths 
both <- str_extract_all(dat, "pneumonia_and_covid_19_deaths = \"[:alnum:]+")
both <- str_remove_all(both,"pneumonia_and_covid_19_deaths = \"")

#Total_Deaths 
total <- str_extract_all(dat,"total_deaths = \"[:alnum:]+")
total <- str_remove_all(total, "total_deaths = \"")
```

```{r Create overall databse, message = FALSE,include = FALSE}
#Create and clean up COVID-19 death data frame 
database <- data.frame(
  Gender = gender,
  State = state,
  Age_Group = age_group,
  Covid_Deaths = covid,
  Pnuemonia_Deaths = pneumonia,
  Covid_and_Pneumonia_Deaths = both,
  Total_Deaths = total
)

database %>% count(Gender)

knitr::kable(database)
```

### Looking at Age, Gender, and State 

The data was cleaned and analyzed to make sure that there was no errors in the data 

```{r,include = FALSE}
#Group by independent variables. 
q1 <- data.frame(
  Gender = gender,
  State = state,
  Age_Group = age_group,
  Covid_Deaths = covid
)
q1 <- q1 %>% mutate(Covid_Deaths = as.numeric(Covid_Deaths))

q1 %>% count(Covid_Deaths)

q1 %>% group_by(Age_Group,Covid_Deaths) %>% summarise()
```


```{r Create Table for Age and COVID-19 Death,message = TRUE}
Age<- q1 %>%
  filter(!(Covid_Deaths %in% NA)) %>% 
  filter(!(Age_Group %in% "All Ages"))%>%
  group_by(Age_Group) %>% 
  summarise_at(vars(Covid_Deaths), list(Covid_Deaths=sum))
knitr::kable(Age)  
```

```{r Create Table for State and COVID-19 Death}
state_death <- q1 %>% 
  filter(!(Covid_Deaths %in% NA)) %>% 
  filter(!(State %in% "United"))%>% 
  group_by(State)%>%
  summarise_at(vars(Covid_Deaths),list("Covid Death"= sum))

knitr::kable(state_death)
```

```{r Create Table for Gender and COVID-19 Death}
gender_death <- q1 %>% 
  filter(!(Covid_Deaths %in% NA)) %>%
  filter(!(Gender %in% "All Sexes")) %>% 
  filter(!(Gender %in% "Unknown")) %>% 
  group_by(Gender)%>%
  summarise_at(vars(Covid_Deaths), list("Covid Death" = sum))

knitr::kable(gender_death)
````
### Looking at COVID-19 Deaths and Pneumonia Deaths 


## Preliminary Results 

## Conclusion 
